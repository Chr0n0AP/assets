! ===================== COPYRIGHT NOTICE =====================
! This file is protected by Copyright. Please refer to the COPYRIGHT file
! distributed with this source distribution.
!
! This file is part of REDHAWK.
!
! REDHAWK is free software: you can redistribute it and/or modify it
! under the terms of the GNU Lesser General Public License as published by the
! Free Software Foundation, either version 3 of the License, or (at your
! option) any later version.
!
! REDHAWK is distributed in the hope that it will be useful, but WITHOUT
! ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
! FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License
! for more details.
!
! You should have received a copy of the GNU Lesser General Public License
! along with this program. If not, see http://www.gnu.org/licenses/.
! ============================================================
!
! Builds the VITA option tree.
!
startmacro a:opt
  ! Check to see that VRTHOME is on the path
  if opt EQS "VITA" then
    import VRTHOME VRTHOME
    if VRTHOME eqs "" then
      import XMAREA_VITA XMAREA_VITA
      res set_vrthome ""

      sedit  XMAREA_VITA index NSEARCH "/vrt/cpp_src/vita" -1
      if index GT 1 then
        sedit  XMAREA_VITA root  RANGE   1 index-1
        res set_vrthome "Suggest using 'setenv VRTHOME ^{ROOT}/vrt/cpp_src/vrt/'"
      endif
      error "$VRTHOME must be set to point to the VRT install directory. ^{set_vrthome}"
    endif
  endif

  ! Cleanup old files
  os /bin/rm -f $XMAREA_VITA/{host,lib}/*.{o,so,exe} >& /dev/null

  ! Make sure the option is on the path
  xmpath +^opt

  ! Build everything
  xmbld *,,,^opt

  genmsginc ^opt
endmacro
